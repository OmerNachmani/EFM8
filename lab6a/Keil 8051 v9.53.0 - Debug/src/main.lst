C51 COMPILER V9.60.0.0   MAIN                                                              01/09/2026 11:54:43 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\src/main.OBJ
COMPILER INVOKED BY: Z:\home\onachman\SimplicityStudio5\SimplicityStudio_v5\developer\toolchains\keil_8051\9.60\BIN\C51 
                    -/home/onachman/SimplicityStudio/v5_workspace/lab6a/src/main.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) F
                    -LOATFUZZY(3) OPTIMIZE(8,SPEED) INTVECTOR(0X0000) INTPROMOTE INCDIR(/home/onachman/SimplicityStudio/v5_workspace/lab6a/in
                    -c;/home/onachman/SimplicityStudio/v5_workspace/lab6a/inc/config;/home/onachman/SimplicityStudio5/SimplicityStudio_v5/dev
                    -eloper/sdks/8051/v4.3.1//kits/common/drivers/efm8_memory_lcd/inc;/home/onachman/SimplicityStudio5/SimplicityStudio_v5/de
                    -veloper/sdks/8051/v4.3.1//kits/common/drivers/efm8_memory_lcd/inc/graphics;/home/onachman/SimplicityStudio5/SimplicitySt
                    -udio_v5/developer/sdks/8051/v4.3.1//kits/common/drivers/efm8_memory_lcd/inc/config;/home/onachman/SimplicityStudio5/Simp
                    -licityStudio_v5/developer/sdks/8051/v4.3.1//kits/common/bsp;/home/onachman/SimplicityStudio5/SimplicityStudio_v5/develop
                    -er/sdks/8051/v4.3.1//kits/EFM8UB2_SLSTK2001A/config;/home/onachman/SimplicityStudio5/SimplicityStudio_v5/developer/sdks/
                    -8051/v4.3.1//Device/shared/si8051Base;/home/onachman/SimplicityStudio5/SimplicityStudio_v5/developer/sdks/8051/v4.3.1//D
                    -evice/EFM8UB2/inc;/home/onachman/SimplicityStudio5/SimplicityStudio_v5/developer/sdks/8051/v4.3.1//kits/common/drivers/e
                    -fm8_joystick;/home/onachman/SimplicityStudio5/SimplicityStudio_v5/developer/sdks/8051/v4.3.1//kits/common/drivers/efm8_r
                    -gb_led;/home/onachman/SimplicityStudio5/SimplicityStudio_v5/developer/sdks/8051/v4.3.1//Device/EFM8UB2/peripheral_driver
                    -/inc) PRINT(.\src/main.lst) COND PAGEWIDTH(120) PAGELENGTH(65) OBJECT(.\src/main.OBJ)

line level    source

   1          /*
   2           * -------------------------------------------------------------------------------------
   3           * –í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å —è–≤–ª—è–µ—Ç—Å—è –≥–ª–∞–≤–Ω–æ—é —Å–∏–ª–æ—é. –≠—Ç–æ–≥–æ –º–æ–µ–≥–æ —É—Ç–≤–µ—Ä–∂
             -–¥–µ–Ω–∏—è –¥–æ —Å–∏—Ö –ø–æ—Ä
   4           * –Ω–µ –æ–ø—Ä–æ–≤–µ—Ä–≥ –Ω–∏ –æ–¥–∏–Ω –±–∏–æ–ª–æ–≥.
   5           *
   6           * –Ø–≤–ª—è—è—Å—å —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –ø—Ä–æ—Ü–≤
             -–µ—Ç–∞–Ω–∏—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ
   7           * —Ä–∞–∑–≤–∏—Ç–∏—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–∞, –∏–Ω—Å—Ç–∏–Ω–∫—Ç –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â–∏ —Å—Ç–∞–ª —Ç–µ–º, —á
             -—Ç–æ –î–∞—Ä–≤–∏–Ω –Ω–∞–∑–≤–∞–ª
   8           * –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø—Ä–∏—Å—É—â–∏–º –∏–Ω—Å—Ç–∏–Ω–∫—Ç–æ–º (a permanent instinct), –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–
             -≥–¥–∞ –≤
   9           * –¥–µ–π—Å—Ç–≤–∏–∏ —É –≤—Å–µ—Ö –æ–±—â–∏—Ç–µ–ª—å–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö, –∏ –≤ —Ç–æ–º —á–∏—Å–ª–µ, –∫–æ–Ω–µ
             -—á–Ω–æ, –∏ —É —á–µ–ª–æ–≤–µ–∫–∞.
  10           *
  11           * –ü—Ä–æ—è–≤–∏–≤—à–∏—Å—å —É–∂–µ –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ —Ä–∞–∑–≤–∏—Ç–∏—è –∂–∏–≤–æ—Ç–Ω–æ–≥–æ –º–∏—Ä–∞, 
             -—ç—Ç–æ—Ç –∏–Ω—Å—Ç–∏–Ω–∫—Ç, –±–µ–∑
  12           * —Å–æ–º–Ω–µ–Ω–∏—è, —Ç–∞–∫ –∂–µ –≥–ª—É–±–æ–∫–æ –∑–∞–ª–æ–∂–µ–Ω –≤–æ –≤—Å–µ—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö, –Ω–∏–∑—à–∏—
             -Ö –∏ –≤—ã—Å—à–∏—Ö, –∫–∞–∫ –∏
  13           * –º–∞—Ç–µ—Ä–∏–Ω—Å–∫–∏–π –∏–Ω—Å—Ç–∏–Ω–∫—Ç; –±—ã—Ç—å –º–æ–∂–µ—Ç, –¥–∞–∂–µ –≥–ª—É–±–∂–µ, —Ç–∞–∫ –∫–∞–∫ –æ–Ω
             - –ø—Ä–∏—Å—É—â –¥–∞–∂–µ –∏ —Ç–∞–∫–∏–º
  14           * –∂–∏–≤–æ—Ç–Ω—ã–º, –∫–∞–∫ —Å–ª–∏–∑–Ω—è–∫–∞–º, –Ω–µ–∫–æ—Ç–æ—Ä—ã–º –Ω–∞—Å–µ–∫–æ–º—ã–º –∏ –±–æ–ª—å—à–æ–π —á
             -–∞—Å—Ç–∏ —Ä—ã–±, —É –∫–æ—Ç–æ—Ä—ã—Ö
  15           * –µ–¥–≤–∞ –ª–∏ –µ—Å—Ç—å –∫–∞–∫–æ–π-–ª–∏–±–æ –º–∞—Ç–µ—Ä–∏–Ω—Å–∫–∏–π –∏–Ω—Å—Ç–∏–Ω–∫—Ç.
  16           *
  17           * –î–∞—Ä–≤–∏–Ω –ø–æ—ç—Ç–æ–º—É –±—ã–ª —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –ø—Ä–∞–≤, —É—Ç–≤–µ—Ä–∂–¥–∞—è, —á—Ç–æ –∏–Ω—Å—Ç–∏
             -–Ω–∫—Ç "–≤–∑–∞–∏–º–Ω–æ–π
  18           * —Å–∏–º–ø–∞—Ç–∏–∏" –±–æ–ª–µ–µ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è —É –æ–±—â–∏—Ç–µ–ª—å–Ω—ã—Ö –∂–∏
             -–≤–æ—Ç–Ω—ã—Ö, —á–µ–º —á–∏—Å—Ç–æ
  19           * —ç–≥–æ–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç–∏–Ω–∫—Ç –ª–∏—á–Ω–æ–≥–æ —Å–∞–º–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –û–Ω –≤–∏–¥–µ–
             -ª –≤ –Ω–µ–º, –∫–∞–∫ –∏–∑–≤–µ—Å—Ç–Ω–æ,
  20           * –∑–∞—á–∞—Ç–∫–∏ –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–æ–≤–µ—Å—Ç–∏, —á—Ç–æ, –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–ª–∏—à–∫–æ–º —
             -á–∞—Å—Ç–æ –∑–∞–±—ã–≤–∞—é—Ç
  21           * –¥–∞—Ä–≤–∏–Ω–∏—Å—Ç—ã.
  22           * -------------------------------------------------------------------------------------
  23           */
  24          #include <SI_EFM8UB2_Register_Enums.h>
  25          #include "InitDevice.h"
  26          #include <stdint.h>
  27          
  28          //-----------------------------------------------------------------------------
  29          // Definitions & Constants
  30          //-----------------------------------------------------------------------------
C51 COMPILER V9.60.0.0   MAIN                                                              01/09/2026 11:54:43 PAGE 2   

  31          #define SPEED_STEP 5
  32          
  33          // Button Pins
  34          SI_SBIT(BTN0, SFR_P0, 2);
  35          SI_SBIT(BTN1, SFR_P0, 3);
  36          
  37          // H-Bridge Driver Pins (Direction)
  38          SI_SBIT(MOTOR_IN1, SFR_P0, 4);
  39          SI_SBIT(MOTOR_IN2, SFR_P0, 5);
  40          
  41          // Global Variables
  42          uint8_t current_direction = 0;
  43          uint16_t current_speed_pwm = 0;
  44          
  45          //-----------------------------------------------------------------------------
  46          // Function Prototypes
  47          //-----------------------------------------------------------------------------
  48          void SiLabs_Startup(void);
  49          void Set_Duty_Cycle(uint16_t dc_percent);
  50          void Delay_ms(uint16_t ms);
  51          
  52          //-----------------------------------------------------------------------------
  53          // SiLabs_Startup
  54          //-----------------------------------------------------------------------------
  55          void SiLabs_Startup (void)
  56          {
  57   1          PCA0MD &= ~0x40; // Disable Watchdog
  58   1      }
  59          
  60          //-----------------------------------------------------------------------------
  61          // Helper Functions
  62          //-----------------------------------------------------------------------------
  63          
  64          // Simple Delay (No tick.h required)
  65          void Delay_ms(uint16_t ms)
  66          {
  67   1          uint16_t i;
  68   1          volatile uint16_t j;
  69   1          for(i = 0; i < ms; i++)
  70   1          {
  71   2              for(j = 0; j < 4000; j++);
  72   2          }
  73   1      }
  74          
  75          // Set PWM Duty Cycle
  76          void Set_Duty_Cycle (uint16_t dc_percent)
  77          {
  78   1          uint32_t cmp_val;
  79   1      
  80   1          if (dc_percent > 100) dc_percent = 100;
  81   1      
  82   1          if (dc_percent == 0)
  83   1          {
  84   2              cmp_val = 65535; // 0% Duty Cycle (Full Low)
  85   2          }
  86   1          else
  87   1          {
  88   2              // Calculate compare value based on inverted logic often used in PCA
  89   2              cmp_val = (65535UL * (100 - dc_percent)) / 100;
  90   2          }
  91   1      
  92   1          PCA0CPL0 = (cmp_val & 0x00FF);
  93   1          PCA0CPH0 = (cmp_val >> 8);
C51 COMPILER V9.60.0.0   MAIN                                                              01/09/2026 11:54:43 PAGE 3   

  94   1      }
  95          
  96          //-----------------------------------------------------------------------------
  97          // Main Loop
  98          //-----------------------------------------------------------------------------
  99          void main (void)
 100          {
 101   1          // Variables
 102   1          uint8_t btn0_prev = 1, btn1_prev = 1;  // Previous button states (1 = released)
 103   1      
 104   1          enter_DefaultMode_from_RESET();
 105   1      
 106   1          // --- FORCE SETTINGS (Safety) ---
 107   1          XBR1 |= 0x40;    // Enable Crossbar
 108   1          PCA0CPM0 |= 0xC2;// Enable 16-bit PWM
 109   1          IE_EA = 1;       // Enable Interrupts
 110   1      
 111   1          // Init Logic
 112   1          current_speed_pwm = 0;
 113   1          current_direction = 0;
 114   1          Set_Duty_Cycle(0);
 115   1      
 116   1          // Set initial direction on pins (stopped)
 117   1          MOTOR_IN1 = 0;
 118   1          MOTOR_IN2 = 0;
 119   1      
 120   1          while (1)
 121   1          {
 122   2              // ==========================================
 123   2              // BTN0: Clockwise - press to go faster
 124   2              // ==========================================
 125   2              if (BTN0 == 0 && btn0_prev == 1)  // Button just pressed (falling edge)
 126   2              {
 127   3                  if (current_direction == 0)
 128   3                  {
 129   4                      // Already clockwise - increase speed
 130   4                      if (current_speed_pwm <= (100 - SPEED_STEP))
 131   4                          current_speed_pwm += SPEED_STEP;
 132   4                      else
 133   4                          current_speed_pwm = 100;
 134   4                  }
 135   3                  else
 136   3                  {
 137   4                      // Was counterclockwise - switch direction, start slow
 138   4                      Set_Duty_Cycle(0);           // Stop first
 139   4                      Delay_ms(300);               // Brief pause
 140   4                      current_direction = 0;       // Switch to clockwise
 141   4                      MOTOR_IN1 = 1;
 142   4                      MOTOR_IN2 = 0;
 143   4                      current_speed_pwm = SPEED_STEP;  // Start at minimum speed
 144   4                  }
 145   3                  Set_Duty_Cycle(current_speed_pwm);
 146   3                  Delay_ms(50);  // Debounce
 147   3              }
 148   2              btn0_prev = BTN0;
 149   2      
 150   2              // ==========================================
 151   2              // BTN1: Counter-clockwise - press to go faster
 152   2              // ==========================================
 153   2              if (BTN1 == 0 && btn1_prev == 1)  // Button just pressed (falling edge)
 154   2              {
 155   3                  if (current_direction == 1)
 156   3                  {
C51 COMPILER V9.60.0.0   MAIN                                                              01/09/2026 11:54:43 PAGE 4   

 157   4                      // Already counterclockwise - increase speed
 158   4                      if (current_speed_pwm <= (100 - SPEED_STEP))
 159   4                          current_speed_pwm += SPEED_STEP;
 160   4                      else
 161   4                          current_speed_pwm = 100;
 162   4                  }
 163   3                  else
 164   3                  {
 165   4                      // Was clockwise - switch direction, start slow
 166   4                      Set_Duty_Cycle(0);           // Stop first
 167   4                      Delay_ms(300);               // Brief pause
 168   4                      current_direction = 1;       // Switch to counterclockwise
 169   4                      MOTOR_IN1 = 0;
 170   4                      MOTOR_IN2 = 1;
 171   4                      current_speed_pwm = SPEED_STEP;  // Start at minimum speed
 172   4                  }
 173   3                  Set_Duty_Cycle(current_speed_pwm);
 174   3                  Delay_ms(50);  // Debounce
 175   3              }
 176   2              btn1_prev = BTN1;
 177   2      
 178   2              Delay_ms(10);
 179   2          }
 180   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    354    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
